<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <link href="https://fonts.googleapis.com/css?family=Vollkorn+SC" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">

    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="index.css">

    <!--jquery-->
    <script
            src="https://code.jquery.com/jquery-3.4.1.js"
            integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
            crossorigin="anonymous"></script>

    <!-- jquery UI -->
    <script
            src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"
            integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30="
            crossorigin="anonymous"></script>

    <title>Welcome</title>

</head>
<body>
<header><div><a>About Me</a></div><div><a href="programming-notes.html">Programming Notes</a></div><div><a href="projects.html">Projects</a></div></header>

<div id="music-bar">
    <div id="music-bar-container">
        <div id = "player-options">
            <span id = "play"><i class="fas fa-play"></i></span>
            <span id="pause"><i class="fas fa-pause"></i></span>
            <span id="skip"><i class="fas fa-step-forward"></i></span>
        </div>
        <div id = "playing-status">paused</div>
    </div>
</div>

<main>
    <div class = "img-container">
        <img class = "image" alt = "profile picture" src="files/profilepicture.PNG">
        <div class="overlay">
            <div class="text">Erol Cimen</div>
        </div>
    </div>

    <div id = "bio">
        <div>
            <p class="list">
                Currently doing:
            </p>
            <hr/>
            <ol>
                <li>Free Code Camp course</li>
                <li>Machine Learning I</li>
                <li>University of Helsinki's Full Stack Open 2019</li>
            </ol>
        </div>
    </div>

</main>

    <audio id = "GTA IV Theme">
        <source src="files/Music/GTA IV Loading Screen Theme Song.mp3">
    </audio>
    <audio id = "Fallout New Vegas Menu Music">
        <source src="files/Music/Fallout%20New%20Vegas%20Main%20Theme%20Song.mp3">
    </audio>
    <audio id = "No Surprises - Radiohead">
        <source src="files/Music/Radiohead - No Surprises.mp3">
    </audio>
    <audio id = "Smokes Quantity - Boards of Canada">
        <source src="files/Music/Boards of Canada - Smokes Quantity.mp3">
    </audio>
    <audio id = "Spirit World Rising - Daniel Johnston">
        <source src="files/Music/Daniel%20Johnston-Spirit%20World%20Rising.mp3">
    </audio>
    <audio id = "I'm So Tired - Fugazi">
        <source src="files/Music/Fugazi%20-%20I'm%20so%20tired.mp3">
    </audio>
    <audio id = "Product of Fear - Ramleh">
        <source src="files/Music/Ramleh%20-%20Product%20of%20Fear.mp3">
    </audio>
    <audio id = "Dawn Chorus - Thom Yorke">
        <source src="files/Music/Thom%20Yorke%20-%20Dawn%20Chorus%20-%20Live%20In%20Paris%202019.mp3">
    </audio>
    <audio id = "Radio Cure - Wilco">
        <source src="files/Music/Wilco-Radio%20Cure.mp3">
    </audio>
    <audio id = "Pink Moon - Nick Drake">
        <source src="files/Music/Pink%20Moon.mp3">
    </audio>
    <audio id = "Sea Song - Robert Wyatt">
        <source src="files/Music/Robert%20Wyatt%20-%20Sea%20Song.mp3">
    </audio>
    <audio id = "My Body is a Cage - Arcade Fire">
        <source src="files/Music/Arcade%20Fire%20-%20My%20Body%20is%20a%20Cage.mp3">
    </audio>
    <audio id = "Carry the Zero - Built to Spill">
        <source src="files/Music/Built%20to%20Spill%20-%20Carry%20The%20Zero.mp3">
    </audio>
    <audio id = "Crimewave - Crystal Castles">
        <source src="files/Music/Crystal%20Castles%20-%20Crimewave.mp3">
    </audio>
    <audio id = "Just Like Heaven - Dinosaur Jr">
        <source src="files/Music/Dinosaur%20Jr.%20-%20Just%20Like%20Heaven.mp3">
    </audio>
    <audio id = "Afterthought - Fugazi">
        <source src="files/Music/Fugazi%20-%20Afterthought.mp3">
    </audio>
    <audio id = "Peep Hole - Guided by Voices">
        <source src="files/Music/Guided%20By%20Voices%20-%20Peep%20Hole.mp3">
    </audio>
    <audio id = "Happiness is Easy - Talk Talk">
        <source src="files/Music/Happiness%20Is%20Easy%20(1997%20Remaster).mp3">
    </audio>
    <audio id = "Indian Summer - Slide">
        <source src="files/Music/Indian%20Summer.mp3">
    </audio>
    <audio id = "Engine (live) - Jeff Mangum">
        <source src="files/Music/Jeff%20Mangum%20-%20Engine%20(Live,%20New%20Year's%20Eve).mp3">
    </audio>
    <audio id = "Lieber Honig - neu!">
        <source src="files/Music/NEU!%20-%20Lieber%20Honig.mp3">
    </audio>
    <audio id = "Happily Divided - Sebadoh">
        <source src="files/Music/Sebadoh%20-%20Happily%20Divided.mp3">
    </audio>
    <audio id = "Strange - Galaxie 500">
        <source src="files/Music/Strange.mp3">
    </audio>
    <audio id = "Candy Says - The Velvet Underground">
        <source src="files/Music/The%20Velvet%20Underground%20-%20Candy%20Says.mp3">
    </audio>

    <script>
        // TODO: prevent repeats (keep an array of no. times played, play the least played)

        let audioElems = Array.from(document.getElementsByTagName("audio")), filteredSelectionIndex = 0, spinningInterval, spinOptions = ['\\', '|', '/', '-'], spinOptionsIndex = 0;

        let setPlayingStatus = (switcher) => {
            if (switcher) {
                spinningInterval = setInterval(function() {
                    document.getElementById('playing-status').innerHTML = 'now playing: ' + audioElemsFilter[filteredSelectionIndex].id + " " + spinOptions[spinOptionsIndex%spinOptions.length] ;
                    spinOptionsIndex++;
                    if (audioElems.every(elem => elem.paused)) {
                        if (audioElems.some(elem => elem.currentTime === elem.duration)) {
                            audioElems.forEach(elem => elem.currentTime = 0);
                            setPlayingStatus(false); // clears the Interval, THEN runs play.
                            play();
                        } else {
                            setPlayingStatus(false);
                        }
                    }
                }, 100);
            } else {
                clearInterval(spinningInterval);
            }
        };

        let playLog = {}, audioElemsFilter; //will keep track of number of plays

        audioElems.forEach((elem) => {
            playLog[elem.id] = 0;
        });

        console.log("The playLog: ", playLog);
        /*the playLog is to prevent repeats and make sure songs are played an even number of times (all played before being played again)
        audioElems (all the audio elements in the page) is filtered (using playLog) every time  the play() function is called
        the new audioElemsFiltered array is created, from which an audio element is selected and played
         */

        let play = () => {
            if (audioElems.every(elem => elem.paused)) {
                if (audioElems.every(elem => elem.currentTime === 0)) {

                    console.log("-------------------------------------");

                    //Object.values(playLog).sort()[0]) is the lowest amount of plays for any audioElems

                    audioElemsFilter = [...audioElems].filter((elem) => {
                        return playLog[elem.id] === Object.values(playLog).sort()[0];
                    });  //remember filter returns a new array, so don't need to copy audioElems can point directly to it if you want
                    //first time you hit play this will filter nothing, i.e. be the same as audioElems

                    console.log("playLog filtered ", audioElemsFilter);

                    filteredSelectionIndex = Math.floor(Math.random()*audioElemsFilter.length);

                    console.log("audio selected: ", audioElemsFilter[filteredSelectionIndex].id);

                    playLog[audioElemsFilter[filteredSelectionIndex].id] += 1;
                    //value increased in the playLog

                    console.log("The playLog: ", playLog);

                    audioElemsFilter[filteredSelectionIndex].play();

                } else {
                    audioElemsFilter[filteredSelectionIndex].play();
                }
                setPlayingStatus(true);
            }
        };

           document.getElementById("play").addEventListener('click', play);

           let pause = () => {
               Array.from(document.getElementsByTagName("audio")).forEach((elem) => elem.pause());
               setPlayingStatus(false);
               document.getElementById('playing-status').innerHTML = "paused";
           };

           document.getElementById("pause").addEventListener('click', pause);

           let skip = () => {
               //pause(); //can't set the currentTime to 0 when the audio is still playing
               /* can't use pause() without setting playing status bar to "paused" before playing next song, so have to
               pause all audio here and clear the interval with setPlayingStatus(false)
                */
               Array.from(document.getElementsByTagName("audio")).forEach((elem) => elem.pause());
               setPlayingStatus(false);
               audioElems.forEach(elem => elem.currentTime = 0);
               play();
           };

           document.getElementById("skip").addEventListener('click', skip);

           window.onload = function () {
               $('#music-bar-container').draggable();
           };


    </script>
</body>
</html>
